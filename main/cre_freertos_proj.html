<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Create a FreeRTOS project</title>
<title>CMSIS-FreeRTOS: Create a FreeRTOS project</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="cmsis.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="printComponentTabs.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 46px;">
  <td id="projectlogo"><img alt="Logo" src="CMSIS_Logo_Final.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">CMSIS-FreeRTOS
   &#160;<span id="projectnumber">Version 10.4.6</span>
   </div>
   <div id="projectbrief">CMSIS-RTOS2 compliant FreeRTOS Implementation</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<div id="CMSISnav" class="tabs1">
    <ul class="tablist">
      <script type="text/javascript">
		<!--
		writeComponentTabs.call(this);
		//-->
      </script>
	  </ul>
</div>
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Usage&#160;and&#160;Description</span></a></li>
      <li><a href="modules.html"><span>Reference</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('cre_freertos_proj.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Create a FreeRTOS project </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>You can basically choose between two option when creating a FreeRTOS project:</p>
<ol type="1">
<li><a class="el" href="cre_freertos_proj.html#native_freertos">Create a native FreeRTOS project</a> using the FreeRTOS API and kernel.</li>
<li><a class="el" href="cre_freertos_proj.html#cmsis_freertos">Create a CMSIS-FreeRTOS project</a> using the CMSIS-RTOS2 API with an underlying FreeRTOS kernel.</li>
</ol>
<h1><a class="anchor" id="native_freertos"></a>
Create a native FreeRTOS project</h1>
<p>The steps to create a microcontroller application using FreeRTOS are:</p>
<ul>
<li>Create a new project and select a microcontroller device.</li>
<li><p class="startli">In the Manage Run-Time Environment window, select <b>::Device:Startup</b>, <b>::RTOS:CORE</b> and <b>::RTOS:Config</b> in the <b>FreeRTOS</b> variant and an applicable <b>::RTOS:Heap</b> scheme (for more information on the heap schemes, visit the FreeRTOS documentation):</p>
<div class="image">
<img src="manage_rte_freertos_native.png" alt="manage_rte_freertos_native.png"/>
</div>
<p class="startli"><br/>
</p>
</li>
<li>If the <b>Validation Output</b> requires other components to be present, try to use the <b>Resolve</b> button.</li>
<li><p class="startli">Click <b>OK</b>. In the <b>Project</b> window, you will see the files that have been automatically added to you project, such as <b>FreeRTOSConfig.h</b>, the source code files, as well as the system and startup files:</p>
<div class="image">
<img src="project_window_freertos_native.png" alt="project_window_freertos_native.png"/>
</div>
</li>
</ul>
<h2><a class="anchor" id="native_freertos_config"></a>
Configure FreeRTOS</h2>
<p>When you have created the native FreeRTOS project, you can configure the real-time operating system using the <b>FreeRTOSConfig.h</b> file. Please refer to the <a href="http://www.freertos.org/a00110.html" target="_blank">FreeRTOS documentation</a> for more information on the specific settings.</p>
<div class="image">
<img src="freertos_config_h_native.png" alt="freertos_config_h_native.png"/>
</div>
<h2><a class="anchor" id="native_freertos_config_prio"></a>
Interrupt priority configuration</h2>
<p>FreeRTOS implements critical sections using the <a href="https://developer.arm.com/documentation/dui0552/a/the-cortex-m3-processor/programmers-model/core-registers?lang=en" target="_blank">BASEPRI</a> register (available in Armv7-M and Armv8-M architecture based devices) which masks only a subset of interrupts. This is configured via the <code>configMAX_SYSCALL_INTERRUPT_PRIORITY</code> setting. Therefore, it is needed to properly configure this setting. It is also needed to set appropriate interrupt priorities for interrupt service routines (ISR) that use RTOS functions. This can especially impact drivers which typically use peripheral interrupts. Normally, these use the RTOS directly or indirectly through registered callbacks.</p>
<p>Arm Cortex-M cores store interrupt priority values in the most significant bits of the interrupt priority registers which can have a maximum of eight bits. Many implementations offer only three priority bits. These three bits are shifted up to be bits five, six and seven respectively. <code>configMAX_SYSCALL_INTERRUPT_PRIORITY</code> must not be 0 and can be xxx00000. This results in the following table:</p>
<table class="doxtable">
<tr>
<th align="center"><code>configMAX_SYSCALL_INTERRUPT_PRIORITY</code> </th><th align="center">Upper three bits </th><th align="center">Priority  </th></tr>
<tr>
<td align="center">32 </td><td align="center">001 </td><td align="center">1 (Highest) </td></tr>
<tr>
<td align="center">64 </td><td align="center">010 </td><td align="center">2 </td></tr>
<tr>
<td align="center">96 </td><td align="center">011 </td><td align="center">3 </td></tr>
<tr>
<td align="center">128 </td><td align="center">100 </td><td align="center">4 </td></tr>
<tr>
<td align="center">160 </td><td align="center">101 </td><td align="center">5 </td></tr>
<tr>
<td align="center">196 </td><td align="center">110 </td><td align="center">6 </td></tr>
<tr>
<td align="center">224 </td><td align="center">111 </td><td align="center">7 (Lowest) </td></tr>
</table>
<p><b>Example</b> </p>
<p>If you set <code>configMAX_SYSCALL_INTERRUPT_PRIORITY</code> to 32, then the priority of an interrupt service routine that uses RTOS functions must then be higher or equal to 1. This ensures that this interrupt will be masked during critical a section.</p>
<p>A WiFi driver using the SPI interface registers a callback to SPI which is executed in an interrupt context. The callback function in the WiFi driver uses RTOS functions. Therefore, the SPI interrupt priority must be set to a value equal or higher to the FreeRTOS preempt priority, for example 1.</p>
<dl class="section note"><dt>Note</dt><dd>For a detailed description of how FreeRTOS is using Cortex-M code registers, refer to <a href="https://www.freertos.org/RTOS-Cortex-M3-M4.html" target="_blank">Running the RTOS on a ARM Cortex-M Core</a>.</dd></dl>
<h2><a class="anchor" id="native_freertos_er"></a>
Add Event Recorder Visibility</h2>
<ul>
<li>To use the Event Recorder together with FreeRTOS, add the software component <b>::Compiler:Event Recorder</b> to your project.</li>
<li>Open <a class="el" href="cre_freertos_proj.html#native_freertos_config">FreeRTOSConfig.h</a> and<ul>
<li>verify the header file <b>freertos_evr.h</b> is included</li>
<li>add Event Recorder configuration definitions (see <a class="el" href="cre_freertos_proj.html#cmsis_freertos_evr_config">Configure Event Recorder</a>)</li>
</ul>
</li>
<li>Call <b><a class="el" href="group__freertos__setup.html#ga943f40b05c79f40c73d67b1adcbe3dbe" title="Setup Event Recorder configuration. ">EvrFreeRTOSSetup()</a></b> in your application code (ideally in <code>main()</code>).</li>
<li>If you are using simulation mode, add an initialization file with the following content: <div class="fragment"><div class="line">MAP 0xE0001000, 0xE0001007 READ WRITE </div>
<div class="line">signal <span class="keywordtype">void</span> DWT_CYCCNT (<span class="keywordtype">void</span>) {</div>
<div class="line"><span class="keywordflow">while</span> (1) {</div>
<div class="line">  rwatch(0xE0001004);</div>
<div class="line">  _WWORD(0xE0001004, states);</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line">DWT_CYCCNT()</div>
</div><!-- fragment --></li>
<li>Build the application code and download it to the debug hardware or run it in simulation.</li>
</ul>
<p>Once the target application generates event information, it can be viewed in the ÂµVision debugger using the <b>Event Recorder</b>.</p>
<h1><a class="anchor" id="cmsis_freertos"></a>
Create a CMSIS-FreeRTOS project</h1>
<p>The steps to create a microcontroller application using CMSIS-FreeRTOS are:</p>
<ul>
<li>Create a new project and select a microcontroller device.</li>
<li><p class="startli">In the Manage Run-Time Environment window, select <b>::Device:Startup</b>, <b>::CMSIS::RTOS2 (API)::FreeRTOS</b>, <b>::RTOS:CORE</b> in the <b>FreeRTOS</b> variant, <b>::RTOS:Config</b> in the <b>CMSIS</b> <b>RTOS2</b> variant, <b>::RTOS:Timers</b>, <b>::RTOS:Event Groups</b>, and an applicable <b>::RTOS:Heap</b> scheme (for more information on the heap schemes, visit the FreeRTOS documentation):</p>
<div class="image">
<img src="manage_rte_freertos_rtos2.png" alt="manage_rte_freertos_rtos2.png"/>
</div>
<p class="startli"><br/>
</p>
</li>
<li>If the <b>Validation Output</b> requires other components to be present, try to use the <b>Resolve</b> button.</li>
<li><p class="startli">Click <b>OK</b>. In the <b>Project</b> window, you will see the files that have been automatically added to you project, such as <b>FreeRTOSConfig.h</b>, the source code files, as well as the system and startup files:</p>
<div class="image">
<img src="project_window_freertos_rtos2.png" alt="project_window_freertos_rtos2.png"/>
</div>
</li>
</ul>
<h2><a class="anchor" id="cmsis_freertos_config"></a>
Configure CMSIS-FreeRTOS</h2>
<p>When you have created the CMSIS-FreeRTOS project, you can configure the real-time operating system using the <b>FreeRTOSConfig.h</b> file. It can be opened using the Configuration Wizard view:</p>
<div class="image">
<img src="freertos_config_h_cmsis_rtos.png" alt="freertos_config_h_cmsis_rtos.png"/>
</div>
<p>The following settings are available:</p>
<table class="doxtable">
<tr>
<th>Name </th><th>#define </th><th>Description  </th></tr>
<tr>
<td>Minimal stack size [words] </td><td>configMINIMAL_STACK_SIZE </td><td>Stack for idle task and default task stack in words. </td></tr>
<tr>
<td>Total heap size [bytes] </td><td>configTOTAL_HEAP_SIZE </td><td>Heap memory size in bytes. </td></tr>
<tr>
<td>Kernel tick frequency [Hz] </td><td>configTICK_RATE_HZ </td><td>Kernel tick rate in Hz. </td></tr>
<tr>
<td>Timer task stack depth [words] </td><td>configTIMER_TASK_STACK_DEPTH </td><td>Stack for timer task in words. </td></tr>
<tr>
<td>Timer task priority </td><td>configTIMER_TASK_PRIORITY </td><td>Timer task priority. </td></tr>
<tr>
<td>Timer queue length </td><td>configTIMER_QUEUE_LENGTH </td><td>Timer command queue length. </td></tr>
<tr>
<td>Preemption interrupt priority </td><td>configMAX_SYSCALL_INTERRUPT_PRIORITY </td><td>Maximum priority of interrupts that are safe to call FreeRTOS API. </td></tr>
<tr>
<td>Use time slicing </td><td>configUSE_TIME_SLICING </td><td>Enable setting to use time slicing. </td></tr>
<tr>
<td>Idle should yield </td><td>configIDLE_SHOULD_YIELD </td><td>Control Yield behavior of the idle task. </td></tr>
<tr>
<td>Check for stack overflow </td><td>configCHECK_FOR_STACK_OVERFLOW </td><td>Enable or disable stack overflow checking. </td></tr>
<tr>
<td>Use idle hook </td><td>configUSE_IDLE_HOOK </td><td>Enable callback function call on each idle task iteration. </td></tr>
<tr>
<td>Use tick hook </td><td>configUSE_TICK_HOOK </td><td>Enable callback function call during each tick interrupt. </td></tr>
<tr>
<td>Use daemon task startup hook </td><td>configUSE_DAEMON_TASK_STARTUP_HOOK </td><td>Enable callback function call when timer service starts. </td></tr>
<tr>
<td>Use malloc failed hook </td><td>configUSE_MALLOC_FAILED_HOOK </td><td>Enable callback function call when out of dynamic memory. </td></tr>
<tr>
<td>Queue registry size </td><td>configQUEUE_REGISTRY_SIZE </td><td>Define maximum number of queue objects registered for debug purposes. </td></tr>
</table>
<dl class="section note"><dt>Note</dt><dd>Refer to <a class="el" href="cre_freertos_proj.html#native_freertos_config_prio">Interrupt priority configuration</a> for more information on the usage of <code>configMAX_SYSCALL_INTERRUPT_PRIORITY</code>.</dd></dl>
<p><b> Event Recorder Configuration </b></p>
<p>The following settings are available (see <a class="el" href="cre_freertos_proj.html#cmsis_freertos_evr_config">Configure Event Recorder</a> for details):</p>
<table class="doxtable">
<tr>
<th>Name </th><th>#define </th><th>Description  </th></tr>
<tr>
<td>Initialize Event Recorder </td><td>configEVR_INITIALIZE </td><td>Initialize Event Recorder before FreeRTOS kernel start. </td></tr>
<tr>
<td>Setup recording level filter </td><td>configEVR_SETUP_LEVEL </td><td>Enable configuration of FreeRTOS events recording level. </td></tr>
<tr>
<td>Task functions </td><td>configEVR_LEVEL_TASKS </td><td>Define event recording level bitmask for events generated from Tasks functions. </td></tr>
<tr>
<td>Queue functions </td><td>configEVR_LEVEL_QUEUE </td><td>Define event recording level bitmask for events generated from Queue functions. </td></tr>
<tr>
<td>Timer functions </td><td>configEVR_LEVEL_TIMERS </td><td>Define event recording level bitmask for events generated from Timer functions. </td></tr>
<tr>
<td>Event Groups functions </td><td>configEVR_LEVEL_EVENTGROUPS </td><td>Define event recording level bitmask for events generated from Event Groups functions. </td></tr>
<tr>
<td>Heap functions </td><td>configEVR_LEVEL_HEAP </td><td>Define event recording level bitmask for events generated from Heap functions. </td></tr>
<tr>
<td>Stream Buffer functions </td><td>configEVR_LEVEL_STREAMBUFFER </td><td>Define event recording level bitmask for events generated from Stream Buffer functions. </td></tr>
</table>
<h2><a class="anchor" id="cmsis_freertos_er"></a>
Add Event Recorder Visibility</h2>
<ul>
<li>To use the Event Recorder together with FreeRTOS, add the software component <b>::Compiler:Event Recorder</b> to your project.</li>
<li>Open <a class="el" href="cre_freertos_proj.html#native_freertos_config">FreeRTOSConfig.h</a> and<ul>
<li>verify the header file <b>freertos_evr.h</b> is included</li>
<li>modify Event Recorder configuration definitions (see <a class="el" href="cre_freertos_proj.html#cmsis_freertos_evr_config">Configure Event Recorder</a>) to change default configuration</li>
</ul>
</li>
<li>Call <b>osKernelInitialize()</b> in your application code (ideally in <code>main()</code>) to setup Event Recorder according to configuration settings.</li>
<li>If you are using simulation mode, add an initialization file with the following content: <div class="fragment"><div class="line">MAP 0xE0001000, 0xE0001007 READ WRITE </div>
<div class="line">signal <span class="keywordtype">void</span> DWT_CYCCNT (<span class="keywordtype">void</span>) {</div>
<div class="line"><span class="keywordflow">while</span> (1) {</div>
<div class="line">  rwatch(0xE0001004);</div>
<div class="line">  _WWORD(0xE0001004, states);</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line">DWT_CYCCNT()</div>
</div><!-- fragment --></li>
<li>Build the application code and download it to the debug hardware or run it in simulation.</li>
</ul>
<p>Once the target application generates event information, it can be viewed in the ÂµVision debugger using the <b>Event Recorder.</b></p>
<h1><a class="anchor" id="freertos_interfaces"></a>
Create a mixed-interface project</h1>
<p>Using CMSIS-RTOS2 API and native FreeRTOS API simultaneously is possible and some projects do require using the native FreeRTOS API and the CMSIS-RTOS2 API at the same time. Such project should be <a class="el" href="cre_freertos_proj.html#cmsis_freertos">created as CMSIS-FreeRTOS project</a>.</p>
<p>Depending on the application requirements, FreeRTOS kernel can be started either by using FreeRTOS native API or by using CMSIS-RTOS2 API.</p>
<h2><a class="anchor" id="freertos_interface_rtos2"></a>
Start the kernel using CMSIS-RTOS2 API</h2>
<div class="fragment"><div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment">  Application thread: Initialize and start the Application</span></div>
<div class="line"><span class="comment">*/</span></div>
<div class="line"><span class="keywordtype">void</span> app_main (<span class="keywordtype">void</span> *argument) {</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">while</span>(1) {</div>
<div class="line">    <span class="comment">// Application code</span></div>
<div class="line">    <span class="comment">// ...</span></div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment">  Main function: Initialize and start the kernel</span></div>
<div class="line"><span class="comment">*/</span></div>
<div class="line"><span class="keywordtype">int</span> main (<span class="keywordtype">void</span>) {</div>
<div class="line">  SystemCoreClockUpdate();</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Initialize CMSIS-RTOS2</span></div>
<div class="line">  osKernelInitialize();</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Create application main thread</span></div>
<div class="line">  osThreadNew(app_main, NULL, NULL);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Start the kernel and execute the first thread</span></div>
<div class="line">  osKernelStart();</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">while</span>(1);</div>
<div class="line">}</div>
</div><!-- fragment --><p><b>Restrictions</b> </p>
<p>After the kernel is started using CMSIS-RTOS2 API, FreeRTOS native API can be used with the following restrictions:</p>
<ul>
<li>vTaskStartScheduler must not be called</li>
</ul>
<h2><a class="anchor" id="freertos_interface_native"></a>
Start the kernel using native API</h2>
<div class="fragment"><div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment">  Application main thread: Initialize and start the application</span></div>
<div class="line"><span class="comment">*/</span></div>
<div class="line"><span class="keywordtype">void</span> app_main (<span class="keywordtype">void</span> *argument) {</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">while</span>(1) {</div>
<div class="line">    <span class="comment">// Application code</span></div>
<div class="line">    <span class="comment">// ...</span></div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment">  Main function: Initialize and start the kernel</span></div>
<div class="line"><span class="comment">*/</span></div>
<div class="line"><span class="keywordtype">int</span> main (<span class="keywordtype">void</span>) {</div>
<div class="line">  SystemCoreClockUpdate();</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Setup the Event Recorder (optionally)</span></div>
<div class="line">  <a class="code" href="group__freertos__setup.html#ga943f40b05c79f40c73d67b1adcbe3dbe">EvrFreeRTOSSetup</a>(0);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Create application main thread</span></div>
<div class="line">  xTaskCreate (app_main, <span class="stringliteral">&quot;app_main&quot;</span>, 64, NULL, tskIDLE_PRIORITY+1, NULL);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Start the kernel and execute the first thread</span></div>
<div class="line">  vTaskStartScheduler();</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">while</span>(1);</div>
<div class="line">}</div>
</div><!-- fragment --><p><b>Restrictions</b> </p>
<p>After the kernel is started using FreeRTOS native API, CMSIS-RTOS2 API can be used without restrictions.</p>
<h1><a class="anchor" id="cmsis_freertos_evr_config"></a>
Configure Event Recorder</h1>
<p>This section describes the configuration settings for the <a href="http://www.keil.com/pack/doc/compiler/EventRecorder/html/index.html" target="_blank">Event Recorder</a> annotations. For more information refer to section <a class="el" href="cre_freertos_proj.html#native_freertos_er">Add Event Recorder Visibility to native FreeRTOS project</a> or <a class="el" href="cre_freertos_proj.html#cmsis_freertos_er">Add Event Recorder Visibility to CMSIS-FreeRTOS project</a>.</p>
<p>Use below definitions to configure Event Recorder initialization and recording level filter setup.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#define configEVR_INITIALIZE</span></div>
</div><!-- fragment --><table class="doxtable">
<tr>
<th>Value </th><th>Description  </th></tr>
<tr>
<td>0 </td><td>Disable Event Recorder initialization </td></tr>
<tr>
<td>1 </td><td>Enable Event Recorder initialization </td></tr>
</table>
<p>Definition configEVR_INITIALIZE enables Event Recorder initialization during execution of function <a class="el" href="group__freertos__setup.html#ga943f40b05c79f40c73d67b1adcbe3dbe">EvrFreeRTOSSetup</a>. Default value is <span class="XML-Token">1</span>.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#define configEVR_SETUP_LEVEL</span></div>
</div><!-- fragment --><table class="doxtable">
<tr>
<th>Value </th><th>Description  </th></tr>
<tr>
<td>0 </td><td>Disable recording level filter setup </td></tr>
<tr>
<td>1 </td><td>Enable recording level filter setup </td></tr>
</table>
<p>Definition configEVR_SETUP_LEVEL enables setup of recording level filter for events generated by FreeRTOS. Recording level is configured during execution of function <a class="el" href="group__freertos__setup.html#ga943f40b05c79f40c73d67b1adcbe3dbe">EvrFreeRTOSSetup</a>. Default value is <span class="XML-Token">1</span>.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#define configEVR_LEVEL_TASKS</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define configEVR_LEVEL_QUEUE</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define configEVR_LEVEL_TIMERS</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define configEVR_LEVEL_EVENTGROUPS</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define configEVR_LEVEL_HEAP</span></div>
<div class="line"><span class="preprocessor">#define configEVR_LEVEL_STREAMBUFFER</span></div>
</div><!-- fragment --><table class="doxtable">
<tr>
<th>Value </th><th>Description  </th></tr>
<tr>
<td>0x00 </td><td>Disable event generation </td></tr>
<tr>
<td>0x01 </td><td>Enable generation of error events </td></tr>
<tr>
<td>0x05 </td><td>Enable generation of error and operational events </td></tr>
<tr>
<td>0x0F </td><td>Enable generation of all events </td></tr>
</table>
<p>Definitions configEVR_LEVEL_x set the recording level bitmask for events generated by each function group. They are taken into account only when recording level filter setup is enabled. Default value is <span class="XML-Token">0x05</span>.</p>
<h1><a class="anchor" id="dbg_cmsisfreertos"></a>
Debug a CMSIS-FreeRTOS project</h1>
<dl class="section note"><dt>Note</dt><dd>The following only applies when used with <a href="https://www2.keil.com/mdk5" target="_blank">Arm Keil MDK</a>. If you are using a different toolchain, please consult its user's manual.</dd></dl>
<p>Apart from the debug capabilities that <a class="el" href="cre_freertos_proj.html#cmsis_freertos_evr_config">Event Recorder</a> offers, Keil MDK also supports thread aware breakpoints, just like for the standard CMSIS-RTOS.</p>
<p><b>Code</b> <b>Example</b> </p>
<div class="fragment"><div class="line">BS FuncN1, 1, <span class="stringliteral">&quot;break = (CURR_TID == tid_phaseA) ? 1 : 0&quot;</span></div>
<div class="line">BS FuncN1, 1, <span class="stringliteral">&quot;break = (CURR_TID == tid_phaseA || CURR_TID == tid_phaseD) ? 1 : 0&quot;</span></div>
<div class="line">BS \\Blinky\Blinky.c\FuncN1\179, 1, <span class="stringliteral">&quot;break = (CURR_TID == tid_phaseA || CURR_TID == tid_phaseD) ? 1 : 0&quot;</span></div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd><ul>
<li>For more information on conditional breakpoints in Keil MDK, consult the <a href="https://www.keil.com/support/man/docs/uv4/uv4_db_dbg_breakpnts.htm" target="_blank">user's manual</a>.</li>
<li>Enabling <a href="https://www.keil.com/support/man/docs/uv4/uv4_ui_view.htm" target="_blank">Periodic Window Update</a> is required to capture register values for active running threads while executing. When turned off, only the current FreeRTOS thread can be unwound after execution has been stopped.</li>
</ul>
</dd></dl>
<p><b>Caveats</b> </p>
<ul>
<li>You cannot specify individual breakpoints on the same address. The following is not possible: <div class="fragment"><div class="line">BS ThCallee, 1, <span class="stringliteral">&quot;break = (CURR_TID==tid_phaseA) ? 1 : 0&quot;</span></div>
<div class="line">BS ThCallee, 1, <span class="stringliteral">&quot;break = (CURR_TID==tid_phaseD) ? 1 : 0&quot;</span></div>
</div><!-- fragment --> Instead, use this: <div class="fragment"><div class="line">BS ThCallee, 1, <span class="stringliteral">&quot;break= (CURR_TID==tid_phaseA || CURR_TID==tid_phaseD) ? 1 : 0&quot;</span></div>
</div><!-- fragment --></li>
<li>If you don't want to use <a href="https://www.keil.com/support/man/docs/uv4/uv4_ui_view.htm" target="_blank">Periodic Window Update</a>, obtain the thread and unwind information by adding a function that gets called from each thread of interest: <div class="fragment"><div class="line">_attribute_((noinline)) int FuncN1 (<span class="keywordtype">int</span> n1) {</div>
<div class="line">  ...</div>
<div class="line">} </div>
</div><!-- fragment --> Then, specify a thread aware breakpoint using an "invalid" thread ID: <div class="fragment"><div class="line">BS FuncN1, 1, <span class="stringliteral">&quot;break = (CURR_TID == tid_phaseA + 1) ? 1 : 0&quot;</span></div>
</div><!-- fragment --> <code>'tid_phaseA'</code> would be valid, <code>'tid_phaseA + 1'</code> is not but will still capture the most recent registers and store them to the actual thread context each time a thread aware breakpoint is checked.</li>
<li>Function inlining typically causes thread aware breakpoints to fail. To avoid this, prepend the <code>'noinline'</code> attribute to the function that is used to stop when the current FreeRTOS thread id matches: <div class="fragment"><div class="line">_attribute_((noinline)) int FuncN1 (<span class="keywordtype">int</span> n1) {</div>
<div class="line">  ...</div>
<div class="line">}</div>
</div><!-- fragment --> This helps to make thread aware breakpoints far less dependent on the compiler optimization level.</li>
<li>Thread aware breakpoints should be setup using a <a href="https://www.keil.com/support/man/docs/uv4/uv4_db_scripting.htm" target="_blank">debug script</a>. Reason being that thread aware breakpoints are of a 'hybrid' type, that is a combined address and condition expression that works best when run from a debug script. </li>
</ul>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Tue Nov 16 2021 09:08:40 for CMSIS-FreeRTOS by ARM Ltd. All rights reserved.
	<!--
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 
	-->
	</li>
  </ul>
</div>
</body>
</html>
